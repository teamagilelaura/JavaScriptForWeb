<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>Fun with Maps</title>
        <script
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyChiImqgh0PZXCgob09FKTVlL8Hdt3NFIs&callback=initMap"
            async
            defer
        ></script>

        <!-- Styles -->
        <style>
            html,
            body {
                margin: 0;
                padding: 0;
            }
            #map {
                width: 100%;
                height: 80%;
            }
            button {
                display: block;
                margin-top: 10px;
            }
            #show-user-location-button {
                background-color: palegreen;
            }
            #show-cities-button {
                background-color: palevioletred;
            }
        </style>

        <!-- Data -->
        <script>
            const cities = [
                {
                    name: 'Hamburg',
                    position: {
                        lat: 53.5511,
                        lng: 9.9937
                    }
                },
                {
                    name: 'Berlin',
                    position: {
                        lat: 52.52,
                        lng: 13.405
                    }
                },
                {
                    name: 'Munich',
                    position: {
                        lat: 48.1351,
                        lng: 11.582
                    }
                },
                {
                    name: 'Karlsruhe',
                    position: {
                        lat: 49.0069,
                        lng: 8.4037
                    }
                },
                {
                    name: 'Frankfurt',
                    position: {
                        lat: 50.1109,
                        lng: 8.6821
                    }
                },
                {
                    name: 'Cologne',
                    position: {
                        lat: 50.9375,
                        lng: 6.9603
                    }
                },
                {
                    name: 'Amsterdam',
                    position: {
                        lat: 52.3667,
                        lng: 4.8945
                    }
                },
                {
                    name: 'Bremen',
                    position: {
                        lat: 53.0793,
                        lng: 8.8017
                    }
                }
            ]
        </script>

        <!-- Logic -->
        <script>
            let map
            function initMap() {
                const mapElement = document.querySelector('#map')
                // new map centered at Cape Town
                map = new google.maps.Map(mapElement, {
                    center: { lat: -33.9249, lng: 18.4241 },
                    zoom: 12
                })

                // initialize actions button after map is loaded
                const showUserLocationButton = document.getElementById('show-user-location-button')
                showUserLocationButton.addEventListener('click', showUserLocation)

                const showCitiesButton = document.getElementById('show-cities-button')
                showCitiesButton.addEventListener('click', showCities)

                map.addListener('click', showMarkerOnClick)
            }

            function showUserLocation() {
                if (navigator.geolocation) {
                    function onSuccess(position) {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        }

                        map.setCenter(userLocation)
                        // no need to save marker in variable
                        new google.maps.Marker({
                            position: userLocation,
                            map: map,
                            // fun stuff
                            animation: google.maps.Animation.DROP,
                            icon: {
                                url: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
                            }
                        })
                    }
                    function onError(error) {
                        console.error('Failed to get current location:', error)
                    }

                    navigator.geolocation.getCurrentPosition(onSuccess, onError)
                } else {
                    console.error('Current location unknown :(')
                }
            }

            function showCities() {
                const bounds = new google.maps.LatLngBounds()
                cities.forEach(city => {
                    const cityMarker = new google.maps.Marker({
                        position: city.position,
                        map: map,
                        animation: google.maps.Animation.DROP
                    })
                    bounds.extend(city.position)
                })
                map.fitBounds(bounds)
            }

            const allClickMarkers = []
            function showMarkerOnClick(event) {
                const marker = new google.maps.Marker({
                    position: event.latLng,
                    map: map
                })
                allClickMarkers.push(marker)

                new google.maps.Polyline({
                    path: allClickMarkers.map(marker => marker.getPosition()),
                    map: map
                })
            }
        </script>
    </head>
    <body>
        <div id="map"></div>
        <div>
            <button id="show-user-location-button">Show my location on map</button>
            <button id="show-cities-button">Show cities on map</button>
        </div>
    </body>
</html>
